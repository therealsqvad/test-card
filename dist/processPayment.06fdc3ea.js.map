{"version":3,"sources":["js/processPayment.js"],"names":["ClientRootURL","Nonce","SessionID","PageMode","MaskedPAN","NonceAddition","number_format","number","decimals","dec_point","thousands_sep","replace","n","isFinite","prec","Math","abs","sep","dec","s","toFixedFix","k","pow","round","split","length","Array","join","ShowMessage","message","$","addClass","html","ShowAlertMessage","document","ready","ajaxSetup","cache","prop","click","URL","InData","base64","encode","val","parseInt","is","getJSON","inData","nonce","String","sessionID","errorOutFormat","done","json","result","code","outData","confirmationType","window","location","attr","tdsRequest","acsURL","paReq","md","submit","fail","jqxhr","textStatus","error"],"mappings":"AAAA,IAAIA,aAAa,GAAG,iBAApB;AACA,IAAIC,KAAK,GAAG,SAAZ;AACA,IAAIC,SAAS,GAAG,aAAhB;AACA,IAAIC,QAAQ,GAAG,YAAf;AACA,IAAIC,SAAS,GAAG,aAAhB;AAEA,IAAIC,aAAa,GAAG,CAApB;;AAGA,SAASC,aAAT,CAAwBC,MAAxB,EAAgCC,QAAhC,EAA0CC,SAA1C,EAAqDC,aAArD,EAAoE;AAClE;AACAH,EAAAA,MAAM,GAAG,CAACA,MAAM,GAAG,EAAV,EAAcI,OAAd,CAAsB,eAAtB,EAAuC,EAAvC,CAAT;;AACA,MAAIC,CAAC,GAAG,CAACC,QAAQ,CAAC,CAACN,MAAF,CAAT,GAAqB,CAArB,GAAyB,CAACA,MAAlC;AAAA,MACEO,IAAI,GAAG,CAACD,QAAQ,CAAC,CAACL,QAAF,CAAT,GAAuB,CAAvB,GAA2BO,IAAI,CAACC,GAAL,CAASR,QAAT,CADpC;AAAA,MAEES,GAAG,GAAI,OAAOP,aAAP,KAAyB,WAA1B,GAAyC,GAAzC,GAA+CA,aAFvD;AAAA,MAGEQ,GAAG,GAAI,OAAOT,SAAP,KAAqB,WAAtB,GAAqC,GAArC,GAA2CA,SAHnD;AAAA,MAIEU,CAAC,GAAG,EAJN;AAAA,MAKEC,UAAU,GAAG,SAAbA,UAAa,CAAUR,CAAV,EAAaE,IAAb,EAAmB;AAC9B,QAAIO,CAAC,GAAGN,IAAI,CAACO,GAAL,CAAS,EAAT,EAAaR,IAAb,CAAR;AACA,WAAO,KAAKC,IAAI,CAACQ,KAAL,CAAWX,CAAC,GAAGS,CAAf,IAAoBA,CAAhC;AACD,GARH,CAHkE,CAYlE;;;AACAF,EAAAA,CAAC,GAAG,CAACL,IAAI,GAAGM,UAAU,CAACR,CAAD,EAAIE,IAAJ,CAAb,GAAyB,KAAKC,IAAI,CAACQ,KAAL,CAAWX,CAAX,CAAnC,EAAkDY,KAAlD,CAAwD,GAAxD,CAAJ;;AACA,MAAIL,CAAC,CAAC,CAAD,CAAD,CAAKM,MAAL,GAAc,CAAlB,EAAqB;AACnBN,IAAAA,CAAC,CAAC,CAAD,CAAD,GAAOA,CAAC,CAAC,CAAD,CAAD,CAAKR,OAAL,CAAa,yBAAb,EAAwCM,GAAxC,CAAP;AACD;;AACD,MAAI,CAACE,CAAC,CAAC,CAAD,CAAD,IAAQ,EAAT,EAAaM,MAAb,GAAsBX,IAA1B,EAAgC;AAC9BK,IAAAA,CAAC,CAAC,CAAD,CAAD,GAAOA,CAAC,CAAC,CAAD,CAAD,IAAQ,EAAf;AACAA,IAAAA,CAAC,CAAC,CAAD,CAAD,IAAQ,IAAIO,KAAJ,CAAUZ,IAAI,GAAGK,CAAC,CAAC,CAAD,CAAD,CAAKM,MAAZ,GAAqB,CAA/B,EAAkCE,IAAlC,CAAuC,GAAvC,CAAR;AACD;;AACD,SAAOR,CAAC,CAACQ,IAAF,CAAOT,GAAP,CAAP;AACD;;AAED,SAASU,WAAT,CAAqBC,OAArB,EACA;AACEC,EAAAA,CAAC,CAAC,UAAD,CAAD,CAAcC,QAAd,CAAuB,cAAvB,EAAuCC,IAAvC,CAA4CH,OAA5C;AACD;;AAED,SAASI,gBAAT,CAA0BJ,OAA1B,EACA;AACEC,EAAAA,CAAC,CAAC,UAAD,CAAD,CAAcE,IAAd,CAAmBH,OAAnB;AACD;;AAEDC,CAAC,CAACI,QAAD,CAAD,CAAYC,KAAZ,CAAkB,YAAW;AAC3BL,EAAAA,CAAC,CAACM,SAAF,CAAY;AAAEC,IAAAA,KAAK,EAAE;AAAT,GAAZ;AACAP,EAAAA,CAAC,CAAC,YAAD,CAAD,CAAgBQ,IAAhB,CAAqB,UAArB,EAAiC,IAAjC;AACD,CAHD;AAKAR,CAAC,CAAC,YAAD,CAAD,CAAgBS,KAAhB,CAAsB,YAAW;AAC/BlC,EAAAA,aAAa;;AAEb,UAAQF,QAAR;AAEE,SAAK,SAAL;AACE,UAAIqC,GAAG,GAAGxC,aAAa,GAAG,UAA1B;AACA,UAAIyC,MAAM,GAAGX,CAAC,CAACY,MAAF,CAASC,MAAT,CAAgB,sBAAsBb,CAAC,CAAC,MAAD,CAAD,CAAUc,GAAV,EAAtB,GAAwC,KAAxD,CAAb;AACA;;AAEF;AACE,UAAIJ,GAAG,GAAGxC,aAAa,GAAG,UAA1B;AACA,UAAIyC,MAAM,GAAGX,CAAC,CAACY,MAAF,CAASC,MAAT,CAAgB,qBAAqBb,CAAC,CAAC,MAAD,CAAD,CAAUc,GAAV,GAAgBjC,OAAhB,CAAwB,KAAxB,EAA+B,EAA/B,CAArB,GAA0D,yBAA1D,GAAsFmB,CAAC,CAAC,MAAD,CAAD,CAAUc,GAAV,GAAgBpB,KAAhB,CAAsB,GAAtB,EAA2B,CAA3B,CAAtF,GAAsH,aAAtH,GAAsIqB,QAAQ,CAACf,CAAC,CAAC,MAAD,CAAD,CAAUc,GAAV,GAAgBpB,KAAhB,CAAsB,GAAtB,EAA2B,CAA3B,CAAD,EAAgC,EAAhC,CAA9I,GAAoL,aAApL,GAAoMM,CAAC,CAAC,MAAD,CAAD,CAAUc,GAAV,EAApM,GAAsN,IAAtN,IAA8Nd,CAAC,CAAC,WAAD,CAAD,CAAegB,EAAf,CAAkB,UAAlB,IAAgC,eAAhC,GAAkD,EAAhR,IAAsR,GAAtS,CAAb;AAEA;AAXJ;;AAcAhB,EAAAA,CAAC,CAAC,YAAD,CAAD,CAAgBQ,IAAhB,CAAqB,UAArB,EAAiC,IAAjC;AACAV,EAAAA,WAAW,CAAC,mDAAD,CAAX;AAEAE,EAAAA,CAAC,CAACiB,OAAF,CACEP,GADF,EACM;AACFQ,IAAAA,MAAM,EAAEP,MADN;AAEFQ,IAAAA,KAAK,EAAEhD,KAAK,GAAG,GAAR,GAAciD,MAAM,CAAC7C,aAAD,CAFzB;AAGF8C,IAAAA,SAAS,EAAEjD,SAHT;AAIFkD,IAAAA,cAAc,EAAE;AAJd,GADN,EAOGC,IAPH,CAOQ,UAASC,IAAT,EAAe;AACnB,QAAIA,IAAI,CAACC,MAAL,CAAYC,IAAZ,IAAoB,CAAxB,EACA;AACE,cAAQF,IAAI,CAACG,OAAL,CAAaC,gBAArB;AAEE,aAAK,CAAL;AACE9B,UAAAA,WAAW,CAAC,8DAAD,CAAX;AAEA+B,UAAAA,MAAM,CAACC,QAAP,CAAgBjD,OAAhB,CAAwBmB,CAAC,CAAC,UAAD,CAAD,CAAcc,GAAd,EAAxB;AAEA;;AAGF,aAAK,CAAL;AACEhB,UAAAA,WAAW,CAAC,8DAAD,CAAX;AAEAE,UAAAA,CAAC,CAAC,UAAD,CAAD,CAAc+B,IAAd,CAAmB,QAAnB,EAA6BP,IAAI,CAACG,OAAL,CAAaK,UAAb,CAAwBC,MAArD;AACAjC,UAAAA,CAAC,CAAC,QAAD,CAAD,CAAYc,GAAZ,CAAgBU,IAAI,CAACG,OAAL,CAAaK,UAAb,CAAwBE,KAAxC;AACAlC,UAAAA,CAAC,CAAC,KAAD,CAAD,CAASc,GAAT,CAAaU,IAAI,CAACG,OAAL,CAAaK,UAAb,CAAwBG,EAArC;AAEAnC,UAAAA,CAAC,CAAC,UAAD,CAAD,CAAcoC,MAAd;AAEA;;AAGF;AACEjC,UAAAA,gBAAgB,CAAC,qDAAuDqB,IAAI,CAACG,OAAL,CAAaC,gBAArE,CAAhB;AAEA;AAzBJ;AA2BD,KA7BD,MA8BK,IAAIJ,IAAI,CAACC,MAAL,CAAYC,IAAZ,IAAoB,MAAxB,EACL;AACEvB,MAAAA,gBAAgB,CAAC,gFAAD,CAAhB;AAEAH,MAAAA,CAAC,CAAC,YAAD,CAAD,CAAgBQ,IAAhB,CAAqB,UAArB,EAAiC,KAAjC;AACD,KALI,MAOL;AACEL,MAAAA,gBAAgB,CAAC,kBAAoBqB,IAAI,CAACC,MAAL,CAAYC,IAAhC,GAAyC,eAAzC,GAA6DF,IAAI,CAACC,MAAL,CAAY1B,OAA1E,CAAhB;AAEAC,MAAAA,CAAC,CAAC,YAAD,CAAD,CAAgBQ,IAAhB,CAAqB,UAArB,EAAiC,KAAjC;AACD;AACF,GAlDH,EAmDG6B,IAnDH,CAmDQ,UAASC,KAAT,EAAgBC,UAAhB,EAA4BC,KAA5B,EAAmC;AACvCrC,IAAAA,gBAAgB,CAAC,sCAAsCoC,UAAtC,GAAmD,IAAnD,GAA0DC,KAA3D,CAAhB;AAEAxC,IAAAA,CAAC,CAAC,YAAD,CAAD,CAAgBQ,IAAhB,CAAqB,UAArB,EAAiC,KAAjC;AACD,GAvDH;AAwDD,CA5ED","file":"processPayment.06fdc3ea.js","sourceRoot":"..","sourcesContent":["var ClientRootURL = \"#clientRootURL#\";\nvar Nonce = \"#nonce#\";\nvar SessionID = \"#sessionID#\";\nvar PageMode = \"#pageMode#\";\nvar MaskedPAN = \"#maskedPAN#\";\n\nvar NonceAddition = 0;\n\n\nfunction number_format (number, decimals, dec_point, thousands_sep) {\n  // Strip all characters but numerical ones.\n  number = (number + '').replace(/[^0-9+\\-Ee.]/g, '');\n  var n = !isFinite(+number) ? 0 : +number,\n    prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),\n    sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep,\n    dec = (typeof dec_point === 'undefined') ? '.' : dec_point,\n    s = '',\n    toFixedFix = function (n, prec) {\n      var k = Math.pow(10, prec);\n      return '' + Math.round(n * k) / k;\n    };\n  // Fix for IE parseFloat(0.55).toFixed(0) = 0;\n  s = (prec ? toFixedFix(n, prec) : '' + Math.round(n)).split('.');\n  if (s[0].length > 3) {\n    s[0] = s[0].replace(/\\B(?=(?:\\d{3})+(?!\\d))/g, sep);\n  }\n  if ((s[1] || '').length < prec) {\n    s[1] = s[1] || '';\n    s[1] += new Array(prec - s[1].length + 1).join('0');\n  }\n  return s.join(dec);\n}\n\nfunction ShowMessage(message)\n{\n  $(\"#message\").addClass('text-success').html(message);\n}\n\nfunction ShowAlertMessage(message)\n{\n  $(\"#message\").html(message);\n}\n\n$(document).ready(function() {\n  $.ajaxSetup({ cache: false });\n  $(\"#payButton\").prop(\"disabled\", true);\n});\n\n$(\"#payButton\").click(function() {\n  NonceAddition++;\n  \n  switch (PageMode)\n  {\n    case \"cvcOnly\":\n      var URL = ClientRootURL + \"payment/\";\n      var InData = $.base64.encode('{\"card\":{\"cvc2\":\"' + $(\"#cvc\").val() + '\"}}');\n      break;\n    \n    default:\n      var URL = ClientRootURL + \"payment/\";\n      var InData = $.base64.encode('{\"card\":{\"pan\":\"' + $(\"#pan\").val().replace(/\\s/g, \"\") + '\",\"expDate\":{\"year\":\"20' + $(\"#exp\").val().split(\"/\")[1] + '\",\"month\":\"' + parseInt($(\"#exp\").val().split(\"/\")[0], 10) + '\"},\"cvc2\":\"' + $(\"#cvc\").val() + '\"}' + ($(\"#saveCard\").is(':checked') ? ',\"saveCard\":1' : '') + '}');\n      \n      break;\n  }\n  \n  $(\"#payButton\").prop(\"disabled\", true);\n  ShowMessage(\"Операция обрабатывается. Пожалуйста, подождите...\");\n  \n  $.getJSON(\n    URL,{\n      inData: InData,\n      nonce: Nonce + \":\" + String(NonceAddition),\n      sessionID: SessionID,\n      errorOutFormat: \"json\"\n    })\n    .done(function(json) {\n      if (json.result.code == 0)\n      {\n        switch (json.outData.confirmationType)\n        {\n          case 1:\n            ShowMessage(\"Осуществляется переход на страницу с результатом операции...\");\n            \n            window.location.replace($(\"#termURL\").val());\n            \n            break;\n          \n          \n          case 2:\n            ShowMessage(\"Осуществляется переход на страницу подтверждения операции...\");\n            \n            $(\"#3dsForm\").attr(\"action\", json.outData.tdsRequest.acsURL);\n            $(\"#paReq\").val(json.outData.tdsRequest.paReq);\n            $(\"#md\").val(json.outData.tdsRequest.md);\n            \n            $(\"#3dsForm\").submit();\n            \n            break;\n          \n          \n          default:\n            ShowAlertMessage(\"Ошибка! Неизвестный тип подтверждения операции: \"  +  json.outData.confirmationType);\n            \n            break;\n        }\n      }\n      else if (json.result.code == 100009)\n      {\n        ShowAlertMessage('Время Вашей сессии истекло! Вернитесь на исходную страницу и повторите платеж.');\n        \n        $(\"#payButton\").prop(\"disabled\", false);\n      }\n      else\n      {\n        ShowAlertMessage(\"Ошибка! Код: \"  +  json.result.code  +  \"; сообщение: \"  +  json.result.message);\n        \n        $(\"#payButton\").prop(\"disabled\", false);\n      }\n    })\n    .fail(function(jqxhr, textStatus, error) {\n      ShowAlertMessage(\"Ошибка запроса в платежный шлюз: \" + textStatus + \"; \" + error);\n      \n      $(\"#payButton\").prop(\"disabled\", false);\n    });\n});\n"]}